"use strict";(self["webpackChunk_3dcourses"]=self["webpackChunk_3dcourses"]||[]).push([[487],{487:function(e,s,t){t.r(s),t.d(s,{default:function(){return C}});var l=t(3396),a=t(9242),i=t(7139);const c=e=>((0,l.dD)("data-v-b638480c"),e=e(),(0,l.Cn)(),e),o={class:"admin_panel"},r=c((()=>(0,l._)("h2",null,"Дать доступ:",-1))),n=c((()=>(0,l._)("option",{disabled:"",value:""},"Выберите один из курсов",-1))),u=["value"],d=c((()=>(0,l._)("button",{type:"submit"},"Добавить",-1))),h={key:0,style:{color:"red",margin:"6px auto"}},_={key:1,style:{color:"green",margin:"6px auto"}},m=c((()=>(0,l._)("h2",null,"Пользователи:",-1))),p={class:"admin_panel__search"},w=c((()=>(0,l._)("span",null,"Поиск:",-1))),y={class:"admin_panel__table"},g=c((()=>(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th",{style:{width:"30px"}},"ID"),(0,l._)("th",{style:{width:"90px"}},"Имя"),(0,l._)("th",{style:{"min-width":"90px"}},"Почта"),(0,l._)("th",{style:{"min-width":"90px"}},"Курсы"),(0,l._)("th",{style:{width:"20px"}})])],-1))),f=["onClick"];function b(e,s,t,c,b,v){return(0,l.wg)(),(0,l.iD)("div",o,[r,(0,l._)("form",{class:"admin_panel__access_form",onSubmit:s[2]||(s[2]=(0,a.iM)(((...e)=>v.onSubmit&&v.onSubmit(...e)),["prevent"]))},[(0,l.wy)((0,l._)("input",{type:"email","onUpdate:modelValue":s[0]||(s[0]=s=>e.email=s),placeholder:"email",required:""},null,512),[[a.nr,e.email,void 0,{trim:!0}]]),(0,l.wy)((0,l._)("select",{"onUpdate:modelValue":s[1]||(s[1]=s=>e.selected_course=s),required:""},[n,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.courses,(e=>((0,l.wg)(),(0,l.iD)("option",{key:e.id,value:e.id},(0,i.zw)(e.title),9,u)))),128))],512),[[a.bM,e.selected_course]]),d,e.error?((0,l.wg)(),(0,l.iD)("h3",h,(0,i.zw)(e.error),1)):(0,l.kq)("",!0),e.success?((0,l.wg)(),(0,l.iD)("h3",_,(0,i.zw)(e.success),1)):(0,l.kq)("",!0)],32),m,(0,l._)("div",p,[w,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":s[3]||(s[3]=s=>e.search=s),placeholder:"email",type:"text"},null,512),[[a.nr,e.search]])]),(0,l._)("table",y,[g,(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.filtered_users,((e,s)=>((0,l.wg)(),(0,l.iD)("tr",{key:s},[(0,l._)("td",null,(0,i.zw)(e.id),1),(0,l._)("td",null,(0,i.zw)(e.name),1),(0,l._)("td",null,(0,i.zw)(e.email),1),(0,l._)("td",null,(0,i.zw)(e.title),1),(0,l._)("td",{style:{color:"red",cursor:"pointer"},onClick:s=>v.deleteAccess(e.id,e.title)}," x ",8,f)])))),128))])])])}var v=t(4161),k=t(9028),D={data:()=>({users:null,filtered_users:null,search:"",email:"",selected_course:"",courses:null,error:"",success:""}),watch:{search(){0!==this.search.length?this.filtered_users=this.users.filter((e=>e.email.includes(this.search))):this.filtered_users=this.users}},methods:{async deleteAccess(e,s){const t=confirm(`Вы уверены, что хотите удалить курс "${s}" у пользователя с ID=${e}?`);if(t)try{const t=await v.Z.post(k.b+"/remove_access",{user_id:e,course_title:s});console.log(t.data),await this.fetchUsers()}catch(l){console.log(l)}},async onSubmit(){console.log("@Submit",this.email,this.selected_course);try{const e=await v.Z.post(k.b+"/add_course_access",{email:this.email,course_id:this.selected_course});console.log(e.data),this.success="Успешно добавлено",setTimeout((()=>{this.success=""}),5e3),await this.fetchUsers()}catch(e){console.log(e),this.error=e.response.data.message?e.response.data.message:e.message,setTimeout((()=>{this.error=""}),5e3)}},async fetchCourses(){try{const e=await v.Z.get(k.b+"/courses");console.log(e.data),this.courses=e.data}catch(e){console.log(e)}},async fetchUsers(){try{const e=await v.Z.post(k.b+"/all_users",{id:this.$store.state.id});console.log(e.data),this.users=e.data,this.filtered_users=this.users}catch(e){console.log(e)}}},async mounted(){await this.fetchUsers(),await this.fetchCourses()}},x=t(89);const z=(0,x.Z)(D,[["render",b],["__scopeId","data-v-b638480c"]]);var C=z}}]);
//# sourceMappingURL=487.5486a878.js.map